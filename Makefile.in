# -* Makefile *- 
#
# Author : Patrick GOLDBRONN (CEA)
# Date : 28/06/2001
# $Header$
#

# source path
top_srcdir=@top_srcdir@
top_builddir=.
srcdir=@srcdir@
VPATH=.:@srcdir@:@top_srcdir@/bin:@top_srcdir@/resources:./bin:@top_srcdir@/idl:${KERNEL_ROOT_DIR}/idl/salome


@COMMENCE@

SUBDIRS = src

ifeq ($(MED_WITH_KERNEL),yes)
      SUBDIRS+= idl
endif

ifeq (@WITHIHM@,yes)
      SUBDIRS+= doc
endif

SUBDIRS+= adm_local

RESOURCES_FILES = \
MEDCatalog.xml \
MED_en.xml \
MED.config \
Data.png \
Infos.png \
Structure.png \
ModuleMed.png \
carre_en_quad4.med \
carre_en_quad4_seg2.med \
cube_hexa8.med \
cube_hexa8_quad4.med \
maill.0.med \
maillage_UniSegFam.med \
mesh.med \
pointe.med \
test19.med \
zzzz121b.med \
Mistrat.med \
TimeStamps.med \
cas_defaut_domaine_fluide.med \
polyedres.med \
polygones.med \
recoll_bord.med \
carre_en_quad4_import22.med \
carre_en_quad4_seg2_import22.med \
cube_hexa8_import22.med \
cube_hexa8_quad4_import22.med \
maillage_UniSegFam_import22.med \
mesh_import22.med \
Mistrat_import22.med \
pointe_import22.med \
TimeStamps_import22.med \
poly3D.med \
Darcy3_3D_H_10x10x10_2.med \
elle_3D_HPr_10x10x10_2.med \
elle_3D_HPr_2x2x2_2.med \
elle_3D_HPr_4x4x4_2.med \
test_2D.med \
maill.00.med \
maill.00_nofield.med \
maill.00_nomesh.med \
maill.00_without_seg2.med \
zzzz121b_without_tr6.med \
Darcy3_3D_H_10x10x10.sauve \
dx200_dy1_avec_2couches.sauve \
elle_2D_QT_10x10.sauve \
elle_2D_QT_2x2.sauve \
elle_2D_QT_40x40.sauve \
elle_2D_QT_4x4.sauve \
elle_3D_HPr_10x10x10.sauve \
elle_3D_HPr_2x2x2.sauve \
elle_3D_HPr_4x4x4.sauve \
inclusion_2d_raf.sauve \
inclusion_2d.sauve \
mail_ktest1-3-hexa.sauve \
mail_ktest1-3-tetra.sauve \
mail_ktest3-1.sauve \
mail_ktest3-2.sauve \
maillage_andra2_100elts.sauve \
maillage_cas2_2d.sauve \
maillage_cas4_234elts.sauve \
maillage_CHEMVAL_100elts.sauve \
maillage_CHEMVAL_40elts.sauve \
maillage_chemvalIV_cas1_100elts.sauve \
maillage_chemvalIV_cas1_40elts.sauve \
mail_test1-1-qua.sauve \
mail_test1-1-tri.sauve \
mail_test1-2-qua.sauve \
mail_test1-2-tri.sauve \
mail-test1-4-1.sauve \
mail-test1-4-2.sauve \
boitenew.inp \
Case1.inp \
cube.inp \
test3.inp \
titi.inp \
boitenew.cnc \
Case1.cnc \
cube.cnc \
test3.cnc \
titi.cnc \
boitenew.xyz \
Case1.xyz \
cube.xyz \
test3.xyz \
titi.xyz

BIN_SCRIPT= \
VERSION

LDFLAGS= -L$(top_builddir)/lib/salome 
LDFLAGSFORBIN= -L$(top_builddir)/lib/salome

# copy header files in common directory
include_list=include/salome/SALOMEconfig.h

ifeq ($(HAVE_SSTREAM),no)
  include_list+=include/salome/sstream
endif

inc: idl $(include_list)

include/salome/SALOMEconfig.h: salome_adm/unix/SALOMEconfig.ref
	-$(RM) $@
	$(LN_S) ../../$< $@

# test if SALOMEconfig.h has changed (contents)
salome_adm/unix/SALOMEconfig.ref: salome_adm/unix/SALOMEconfig.h
	@if ! [ -a $@ ]; then \
	  cp -p -f $< $@;        \
	fi;		      \
	if ! cmp $< $@; then  \
	  cp -p -f $< $@;        \
	fi;		      \

include/salome/sstream: salome_adm/unix/sstream
	-$(RM) $@
	$(LN_S) ../../$< $@

depend: depend_idl

depend_idl:
	(cd idl ; $(MAKE) $@) || exit 1

# doc is already build : if you want to had documents, go manually to doc and run 'make doc'
#doc:
#	(cd doc && $(MAKE) $@) || exit 1

install-end:
# finish libtool install
#	@$(LT) --mode=finish $(libdir)

install-include: $(include_list)
	$(INSTALL) -d  $(includedir)
#	@for f in X $(include_list); do				\
#	   if test $$f != X; then				\
#	     (cp -p $$f $(includedir) || exit 1);		\
#	   fi;							\
	done

# install script in $(bindir) :
install-bin: $(BIN_SCRIPT)
	$(INSTALL) -d  $(bindir)
	for f in X $(BIN_SCRIPT); do				\
	   if test $$f != X; then				\
	     (cp -p -f ./bin/salome/$$f $(bindir) || exit 1);	\
	   fi;							\
	done

uninstall: uninstall-idl

uninstall-idl:
	$(RM) $(idldir)/*.idl

distclean: distclean-other

distclean-other:
	-$(RM) salome_adm/unix/*~ salome_adm/unix/*% salome_adm/unix/*.bak salome_adm/unix/*.new salome_adm/unix/*.old
	-$(RM) salome_adm/unix/make_* 
	-$(RM) salome_adm/unix/depend salome_adm/unix/SALOMEconfig.h 
	-$(RM) config.cache config.log config.status 

@MODULE@

install: install-bin install-include install-end

